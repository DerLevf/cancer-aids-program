<div class="profile card">
  <% @user.reload if @user.persisted? %>
  <h1>Profil von <%= @user.username %></h1>

  <div class="details-section">
    <p><strong>Benutzername:</strong> <%= @user.username %></p>
    <p><strong>E-Mail:</strong> <%= @user.email %></p>
    <p><strong>Kontostand (Budget):</strong> <%= number_to_currency(@user.budget || 0, unit: "CHF") %></p>
  </div>
  <hr>

  <h2>Deine Schuldengruppen</h2>
  <% if @debt_projects.any? %>
    <ul class="styled-list">
      <% @debt_projects.each do |project| %>
        <li>
          <%= link_to debt_project_path(project), class: "list-link-block" do %>
            <span><%= project.name %></span>
            <span class="member-tag role">
              Rolle: <%= project.group_memberships.find_by(user: @user)&.role.humanize %>
            </span>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="empty-state">Keine Schuldengruppen vorhanden.</p>
  <% end %>

  <hr>

  <h2>Dir zugewiesene Aufgaben</h2>
  <%# Die @assigned_tasks Liste enthÃ¤lt nun nur NICHT-erledigte Aufgaben %>
  <% if @assigned_tasks.any? %>
    <ul class="styled-list">
      <% @assigned_tasks.each do |task| %>
        <li>
          <%= link_to debt_project_task_path(task.debt_project, task), class: "list-link-block" do %>
            <span class="task-title"><%= task.title %></span>
            <span class="member-tag status-<%= task.status %>"><%= task.status.humanize %></span>
            <span class="group-name"><%= task.debt_project.name %></span>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="empty-state">Keine Aufgaben zugewiesen.</p>
  <% end %>

  <hr>
  <h2>Dir zugewiesene Aufgaben</h2>
  <% if @assigned_tasks.any? %>
    <ul class="styled-list">
      <% @assigned_tasks.each do |task| %>
        <li>
          <%= link_to debt_project_task_path(task.debt_project, task), class: "list-link-block" do %>
            <span class="task-title"><%= task.title %></span>
            <span class="member-tag status-<%= task.status %>"><%= task.status.humanize %></span>
            <span class="group-name"><%= task.debt_project.name %></span>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="empty-state">Keine Aufgaben zugewiesen.</p>
  <% end %>

  <hr>

  <%= link_to "Profil bearbeiten", edit_user_path(@user), class: "btn btn-warning" %>
</div>