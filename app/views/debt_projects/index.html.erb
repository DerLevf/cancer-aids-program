<h1>Deine Schuldengruppen</h1>

<% if current_user %>
  <%= button_to "Abmelden", logout_path, method: :delete, class: "bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mb-4" %>
<% end %>

<%= link_to "+ Neue Gruppe", new_debt_project_path, class: "bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4" %>

<% if @debt_projects.any? %>
  <ul>
    <% @debt_projects.each do |project| %>
      <li class="bg-gray-100 p-4 mb-4 rounded-lg shadow-md">
        <strong><%= project.name %></strong>
        <p>Betrag: <%= number_to_currency(project.total_amount || 0, unit: "CHF") %></p>
        <p>Frist: <%= project.deadline.strftime("%d.%m.%Y") if project.deadline %></p>
        <p>Erstellt von: <%= project.creator.username if project.creator %></p>
        <p>
          Mitglieder:
          <% project.group_memberships.includes(:user).each do |membership| %>
            <% next unless membership.user %>
            <%= membership.user.username %> (<%= membership.role %>)
          <% end %>
        </p>

        <% if policy(project).edit? %>
          <%= link_to "Bearbeiten", edit_debt_project_path(project), class: "bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-1 px-3 rounded mt-2 inline-block" %>
        <% end %>

        <% if policy(project).destroy? %>
          <%= button_to "Löschen", debt_project_path(project), method: :delete, data: { confirm: "Willst du diese Gruppe wirklich löschen?" }, class: "bg-red-500 hover:bg-red-700 text-white font-bold py-1 px-3 rounded mt-2 inline-block" %>
        <% end %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>Du bist noch in keiner Schuldengruppe.</p>
<% end %>
