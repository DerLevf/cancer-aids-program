<h1>Deine Schuldengruppen</h1>

<%= link_to "+ Neue Gruppe", new_debt_project_path, class: "btn btn-primary mb-4" %>

<% if @debt_projects.any? %>
  <div class="table-container">
    <%# ADD: data-controller attribute to the table for Stimulus %>
    <table class="debt-projects-table" data-controller="table-link"> 
      <thead>
        <tr>
          <th>Name</th>
          <th>Betrag</th>
          <th>Frist</th>
          <th>Erstellt von</th>
          <th>Mitglieder</th>
          <th>Aktionen</th>
        </tr>
      </thead>
      <tbody>
        <% @debt_projects.each do |project| %>
          <tr class="clickable-row" 
              data-href="<%= debt_project_path(project) %>"
              data-action="click->table-link#navigate"> <%# ADD: Stimulus action %>
            <td><%= project.name %></td>
            <td><%= number_to_currency(project.total_amount || 0, unit: "CHF") %></td>
            <td><%= project.deadline&.strftime("%d.%m.%Y") || "-" %></td>
            <td><%= project.creator&.username || "Unbekannt" %></td>
            <td>
              <% project.group_memberships.includes(:user).each do |membership| %>
                <% next unless membership.user %>
                <%# FIX: Ensure CSS classes match your roles (e.g., 'member' and 'owner') %>
                <span class="member member-<%= membership.role %>"> 
                  <%= membership.user.username %>
                </span>
              <% end %>
            </td>
            <td>
              <% if policy(project).edit? %>
                <%= link_to "Bearbeiten", edit_debt_project_path(project), class: "btn btn-warning" %>
              <% end %>
              <% if policy(project).destroy? %>
                <%= button_to "Löschen", debt_project_path(project), method: :delete,
                      data: { confirm: "Willst du diese Gruppe wirklich löschen?" },
                      class: "btn btn-danger" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <p>Du bist noch in keiner Schuldengruppe.</p>
<% end %>

<%# REMOVED THE INLINE <SCRIPT> BLOCK %>