<div class="project-details-container">
  
  <h1><%= @debt_project.name %></h1>

  <div class="card project-summary">
    <p><strong>Gesamtbetrag:</strong> <%= number_to_currency(@debt_project.total_amount || 0, unit: "CHF") %></p>
    <p><strong>Frist:</strong> <%= @debt_project.deadline&.strftime("%d.%m.%Y") || "Keine Frist" %></p>
    <p><strong>Erstellt von:</strong> <%= @debt_project.creator&.username || "Unbekannt" %></p>
  </div>

  <div class="action-buttons-group">
    <%# Bearbeiten & Löschen nur für DebtCollector %>
    <% if policy(@debt_project).edit? %>
      <%= link_to "Bearbeiten", edit_debt_project_path(@debt_project), class: "btn btn-warning" %>
    <% end %>

    <% if policy(@debt_project).destroy? %>
      <%= button_to "Löschen", debt_project_path(@debt_project), method: :delete, data: { turbo_confirm: "Willst du diese Gruppe wirklich löschen?" }, class: "btn btn-danger" %>
    <% end %>
  </div>

  <h2>Mitglieder</h2>
  <ul class="member-list card">
    <% @debt_project.group_memberships.includes(:user).each do |membership| %>
      <% next unless membership.user %>
      <%# Use the CSS classes defined for membership roles %>
      <li class="member <%= membership.role.to_s.underscore %>">
        <%= membership.user.username %> (<%= membership.role.humanize %>)
      </li>
    <% end %>
  </ul>
  
  <hr class="separator">

  <h2>Aufgaben</h2>
  <div class="tasks-list">
    <% @debt_project.tasks.each do |task| %>
      <div class="card task-item">
        <p><strong>Titel:</strong> <%= task.title %></p>
        <p><strong>Beschreibung:</strong> <%= task.description %></p>
        <p><strong>Zugewiesen an:</strong> <%= task.assigned_user&.username || "Nicht zugewiesen" %></p>
        <p>
          <strong>Status:</strong> 
          <span class="member status-tag status-<%= task.status %>"><%= task.status.humanize %></span>
        </p>

        <div class="task-actions">
          <%# Bearbeiten & Löschen nur für Berechtigte %>
          <% if policy(task).update? %>
            <%= link_to "Bearbeiten", edit_debt_project_task_path(@debt_project, task), class: "btn btn-warning btn-small" %>
          <% end %>

          <% if policy(task).destroy? %>
            <%= button_to "Löschen", debt_project_task_path(@debt_project, task), method: :delete, data: { turbo_confirm: "Willst du diese Aufgabe wirklich löschen?" }, class: "btn btn-danger btn-small" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <%# Neue Aufgabe nur für Berechtigte %>
  <% if policy(Task.new(debt_project: @debt_project)).create? %>
    <%= link_to "Neue Aufgabe", new_debt_project_task_path(@debt_project), class: "btn btn-primary new-task-button" %>
  <% end %>

  <%= link_to "Zurück zur Übersicht", debt_projects_path, class: "back-link" %>
</div>